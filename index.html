<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name="theme-color" content="#0a84ff"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="apple-mobile-web-app-title" content="WorkBreak"><title>WorkBreak</title><style>
:root{--bg:#0b0b0f;--card:#14141a;--muted:#9aa0a6;--text:#f2f3f5;--accent:#0a84ff;--danger:#ff453a;--ok:#30d158;--line:rgba(255,255,255,.08)}
@media (prefers-color-scheme: light){:root{--bg:#f5f5f7;--card:#ffffff;--muted:#6b7280;--text:#111827;--accent:#0a84ff;--danger:#dc2626;--ok:#16a34a;--line:rgba(17,24,39,.08)}}
*{box-sizing:border-box}html,body{height:100%;width:100%;max-width:100%;overflow-x:hidden}body{margin:0;width:100vw;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text);-webkit-text-size-adjust:100%}
.wrap{max-width:740px;margin:0 auto;padding:18px 14px calc(40px + env(safe-area-inset-bottom))}
@media(max-width:430px){.wrap{padding:14px 12px calc(34px + env(safe-area-inset-bottom));max-width:100%;width:100%}}
.top{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:6px 2px 14px;position:sticky;top:0;background:linear-gradient(to bottom,var(--bg) 70%,transparent);padding-top:env(safe-area-inset-top);padding-bottom:10px;z-index:10}
.brand{display:flex;align-items:center;gap:10px;min-width:0}
.logo{width:38px;height:38px;border-radius:12px;background:var(--accent);display:grid;place-items:center;color:white;font-weight:900;flex:0 0 auto}
h1{font-size:18px;margin:0;line-height:1.1}
.sub{font-size:12px;color:var(--muted);margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:44vw}
.tabs{display:flex;gap:8px;flex:0 0 auto}
.tab{border:1px solid var(--line);background:transparent;color:var(--text);padding:10px 12px;border-radius:12px;font-weight:800;font-size:13px;min-height:44px}
.tab.active{background:var(--card);border-color:transparent;box-shadow:0 1px 0 rgba(0,0,0,.08)}
.card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:14px}
@media(max-width:430px){.card{padding:12px;border-radius:16px}}
.grid{display:grid;grid-template-columns:1fr;gap:10px}
@media(min-width:520px){.grid{grid-template-columns:1fr 1fr}}
.field{display:flex;flex-direction:column;gap:6px}
label{font-size:12px;color:var(--muted);font-weight:800;letter-spacing:.2px}
input[type="time"],input[type="date"]{width:100%;padding:12px 12px;border-radius:14px;border:1px solid var(--line);background:transparent;color:var(--text);font-size:17px;outline:none;min-height:48px}
.row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.btn{border:0;border-radius:14px;padding:12px 14px;font-weight:900;font-size:14px;min-height:48px}
.btn.primary{background:var(--accent);color:white;flex:1;min-width:170px}
.btn.ok{background:var(--ok);color:#001b06;flex:1;min-width:170px}
.btn.ghost{background:transparent;color:var(--text);border:1px solid var(--line);min-width:120px}
.btn.danger{background:var(--danger);color:white;min-width:120px}
.btn:disabled{opacity:.5}
.kpis{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}
@media(min-width:520px){.kpis{grid-template-columns:1fr 1fr}}
.kpi{border:1px solid var(--line);border-radius:16px;padding:12px}
.kpi .t{font-size:12px;color:var(--muted);font-weight:800}
.kpi .v{font-size:20px;font-weight:950;margin-top:6px}
.kpi .h{font-size:12px;color:var(--muted);margin-top:6px}
.sep{height:1px;background:var(--line);margin:14px 0}
.list{display:flex;flex-direction:column;gap:8px}
.item{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px;border:1px solid var(--line);border-radius:16px;min-height:56px}
.item.active{border-color:rgba(10,132,255,.45);box-shadow:0 0 0 3px rgba(10,132,255,.12)}
.item .left{display:flex;flex-direction:column;gap:4px;min-width:0}
.item .d{font-weight:950}
.item .m{font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.pill{padding:8px 10px;border-radius:999px;border:1px solid var(--line);font-weight:950;white-space:nowrap}
.pill.ok{border-color:rgba(48,209,88,.35);color:var(--ok)}
.pill.muted{color:var(--muted)}
.small{font-size:12px;color:var(--muted);line-height:1.35}
.footer{margin-top:14px}
.notice{padding:12px;border-radius:16px;border:1px dashed var(--line);color:var(--muted);font-size:12px}
.hidden{display:none}
a{color:var(--accent);text-decoration:none}
.toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.toolbar .btn{min-width:auto;flex:0 0 auto}
.badge{font-size:12px;color:var(--muted);font-weight:800}
.detail{margin-top:12px;border:1px solid var(--line);border-radius:16px;padding:12px}
.detailgrid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
@media(min-width:520px){.detailgrid{grid-template-columns:1fr 1fr}}
.kv{display:flex;justify-content:space-between;gap:10px;padding:10px;border:1px solid var(--line);border-radius:14px}
.kv .k{font-size:12px;color:var(--muted);font-weight:800}
.kv .v{font-weight:950}

@media(max-width:430px){
.top{gap:10px}
.sub{max-width:38vw}
.tabs{gap:6px}
.tab{padding:10px 10px;min-width:0}
.row{flex-direction:column}
.btn{width:100%;min-width:0;flex:0 0 auto}
.toolbar{justify-content:space-between}
}
</style></head><body><div class="wrap"><div class="top"><div class="brand"><div class="logo">R</div><div style="min-width:0"><h1>WorkBreak</h1><div class="sub" id="subtitle"></div></div></div><div class="tabs"><button class="tab active" id="tabToday">Today</button><button class="tab" id="tabWeek">Week</button></div></div>

<div id="viewToday" class="card">
<div class="grid">
<div class="field"><label>Date</label><input id="date" type="date"></div>
<div class="field"><label>Check In</label><input id="checkIn" type="time" step="60"></div>
<div class="field"><label>Break Start</label><input id="ritStart" type="time" step="60"></div>
<div class="field"><label>Break End</label><input id="ritEnd" type="time" step="60"></div>
<div class="field"><label>Check Out</label><input id="checkOut" type="time" step="60"></div>
</div>

<div class="row">
<button class="btn primary" id="saveBtn">Save progress</button>
<button class="btn ok" id="finishBtn">Shift finished</button>
<button class="btn ghost" id="fillNowBtn">Fill now</button>
<button class="btn danger" id="deleteBtn">Delete day</button>
</div>

<div class="kpis">
<div class="kpi"><div class="t">Status</div><div class="v" id="kStatus">--</div><div class="h" id="hStatus"></div></div>
<div class="kpi"><div class="t">Total Worked Today</div><div class="v" id="kTotal">--</div><div class="h">(Check Out − Check In) − Break Time</div></div>
</div>

<div class="kpis">
<div class="kpi"><div class="t">Break Time</div><div class="v" id="kRit">--</div><div class="h">Break End − Break Start</div></div>
<div class="kpi"><div class="t">This Week Total</div><div class="v" id="kWeek">--</div><div class="h" id="hWeek"></div></div>
</div>

<div class="footer"><div class="notice">Your data is saved on this device (browser storage). Use Week → Download backup to keep a copy.</div></div>
</div>

<div id="viewWeek" class="card hidden">
<div class="toolbar">
<button class="btn ghost" id="prevWeekBtn">◀︎ Prev</button>
<button class="btn ghost" id="thisWeekBtn">This week</button>
<button class="btn ghost" id="nextWeekBtn">Next ▶︎</button>
<span class="badge" id="weekRange"></span>
</div>
<div class="sep"></div>
<div class="list" id="weekList"></div>

<div id="dayDetail" class="detail hidden">
<div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
<div>
<div style="font-weight:950" id="detailTitle">Day</div>
<div class="small" id="detailSub"></div>
</div>
<button class="btn ghost" id="editDayBtn">Edit</button>
</div>
<div class="detailgrid">
<div class="kv"><div class="k">Check In</div><div class="v" id="dCheckIn">--</div></div>
<div class="kv"><div class="k">Break Start</div><div class="v" id="dRitStart">--</div></div>
<div class="kv"><div class="k">Break End</div><div class="v" id="dRitEnd">--</div></div>
<div class="kv"><div class="k">Check Out</div><div class="v" id="dCheckOut">--</div></div>
<div class="kv"><div class="k">Break Time</div><div class="v" id="dRitTime">--</div></div>
<div class="kv"><div class="k">Total Worked</div><div class="v" id="dTotal">--</div></div>
</div>
</div>

<div class="sep"></div>
<div class="kpis">
<div class="kpi"><div class="t">Weekly Total</div><div class="v" id="wkTotal">--</div><div class="h">Sum of worked time in this week</div></div>
<div class="kpi"><div class="t">Backup</div><div class="v" style="font-size:14px;font-weight:950">JSON</div><div class="h"><a href="#" id="exportBtn">Download</a> · <a href="#" id="importBtn">Import</a></div></div>
</div>
<input id="importFile" type="file" accept="application/json" class="hidden">
</div>

</div>

<script>
const SKEY="workrit_entries_v4"
const $=id=>document.getElementById(id)
const tabToday=$("tabToday"),tabWeek=$("tabWeek"),viewToday=$("viewToday"),viewWeek=$("viewWeek")
const dateEl=$("date"),checkInEl=$("checkIn"),ritStartEl=$("ritStart"),ritEndEl=$("ritEnd"),checkOutEl=$("checkOut")
const saveBtn=$("saveBtn"),finishBtn=$("finishBtn"),deleteBtn=$("deleteBtn"),fillNowBtn=$("fillNowBtn")
const kStatus=$("kStatus"),hStatus=$("hStatus"),kRit=$("kRit"),kTotal=$("kTotal"),kWeek=$("kWeek"),hWeek=$("hWeek"),subtitle=$("subtitle")
const prevWeekBtn=$("prevWeekBtn"),nextWeekBtn=$("nextWeekBtn"),thisWeekBtn=$("thisWeekBtn"),weekRangeEl=$("weekRange"),weekList=$("weekList"),wkTotal=$("wkTotal"),exportBtn=$("exportBtn"),importBtn=$("importBtn"),importFile=$("importFile")
const dayDetail=$("dayDetail"),detailTitle=$("detailTitle"),detailSub=$("detailSub"),editDayBtn=$("editDayBtn")
const dCheckIn=$("dCheckIn"),dRitStart=$("dRitStart"),dRitEnd=$("dRitEnd"),dCheckOut=$("dCheckOut"),dRitTime=$("dRitTime"),dTotal=$("dTotal")
const pad=n=>String(n).padStart(2,"0")
const toYMD=d=>`${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`
const parseTime=(ymd,hm)=>{if(!hm||!ymd)return null;const [H,M]=hm.split(":").map(Number);const [y,m,da]=ymd.split("-").map(Number);return new Date(y,m-1,da,H,M,0,0)}
const msBetween=(a,b)=>a&&b?b.getTime()-a.getTime():null
const clampNonNeg=ms=>ms==null?null:Math.max(0,ms)
const fmtDur=ms=>{if(ms==null)return"--";ms=Math.round(ms/60000)*60000;const totalMin=Math.max(0,Math.floor(ms/60000));const h=Math.floor(totalMin/60),m=totalMin%60;return `${h}h ${pad(m)}m`}
const weekStart=d=>{const c=new Date(d.getFullYear(),d.getMonth(),d.getDate(),12,0,0,0);const day=(c.getDay()+6)%7;c.setDate(c.getDate()-day);c.setHours(0,0,0,0);return c}
const weekEndExclusive=d=>{const s=weekStart(d);const e=new Date(s);e.setDate(e.getDate()+7);return e}
const inRange=(d,start,endEx)=>d>=start&&d<endEx
const load=()=>{try{const raw=localStorage.getItem(SKEY);if(!raw)return{};const obj=JSON.parse(raw);return obj&&typeof obj==="object"?obj:{}}catch{return{}}}
const saveAll=obj=>localStorage.setItem(SKEY,JSON.stringify(obj))
const getEntry=ymd=>load()[ymd]||null
const setEntry=(ymd,entry)=>{const all=load();all[ymd]=entry;saveAll(all)}
const delEntry=ymd=>{const all=load();delete all[ymd];saveAll(all)}
const clean=v=>v&&v.trim()?v.trim():""
const computeFrom=(ymd,vals)=>{const ci=parseTime(ymd,clean(vals.checkIn));const rs=parseTime(ymd,clean(vals.ritStart));const re=parseTime(ymd,clean(vals.ritEnd));const co=parseTime(ymd,clean(vals.checkOut));const brk=clampNonNeg(msBetween(rs,re));const span=clampNonNeg(msBetween(ci,co));let total=null;if(span!=null&&brk!=null)total=clampNonNeg(span-brk);return{ci,rs,re,co,brk,span,total}}
const computeForInputs=()=>computeFrom(dateEl.value,{checkIn:checkInEl.value,ritStart:ritStartEl.value,ritEnd:ritEndEl.value,checkOut:checkOutEl.value})
const statusFor=e=>{if(!e||(!e.checkIn&&!e.ritStart&&!e.ritEnd&&!e.checkOut))return{t:"Empty",h:"Fill any time(s) then tap Save progress"};if(e.checkIn&&e.ritStart&&e.ritEnd&&e.checkOut)return{t:"Finished",h:"Saved for this day"};return{t:"In progress",h:"You can keep saving as you fill more fields"}}

let weekOffset=0
let selectedYmd=null

const weekAnchor=()=>{const d=new Date();d.setHours(12,0,0,0);d.setDate(d.getDate()+weekOffset*7);return d}
const currentWeekRange=()=>{const a=weekAnchor();const ws=weekStart(a),we=weekEndExclusive(a);return{ws,we}}
const labelWeekRange=(ws,we)=>`${toYMD(ws)} → ${toYMD(new Date(we.getTime()-86400000))}`

const renderToday=()=>{
const ymd=dateEl.value
const saved=getEntry(ymd)||{}
const st=statusFor(saved)
kStatus.textContent=st.t
hStatus.textContent=st.h
const r=computeForInputs()
kRit.textContent=fmtDur(r.brk)
kTotal.textContent=fmtDur(r.total)
finishBtn.disabled=!(checkInEl.value&&ritStartEl.value&&ritEndEl.value&&checkOutEl.value)
renderThisWeekSummary()
}

const renderThisWeekSummary=()=>{
const now=new Date()
const ws=weekStart(now),we=weekEndExclusive(now)
const all=load()
let sum=0
for(const [ymd,entry] of Object.entries(all)){
const d=new Date(ymd+"T00:00:00")
if(inRange(d,ws,we)){const t=computeFrom(ymd,entry).total;if(t!=null)sum+=t}
}
kWeek.textContent=fmtDur(sum)
hWeek.textContent=labelWeekRange(ws,we)
subtitle.textContent=`Week: ${labelWeekRange(ws,we)}`
}

const renderWeekView=()=>{
const {ws,we}=currentWeekRange()
weekRangeEl.textContent=labelWeekRange(ws,we)
const all=load()
const days=[]
for(let i=0;i<7;i++){const d=new Date(ws);d.setDate(d.getDate()+i);const ymd=toYMD(d);days.push({d,ymd,e:all[ymd]||null})}
weekList.innerHTML=""
let sum=0
for(const day of days){
let pillClass="muted",pillText="No entry"
if(day.e){
const t=computeFrom(day.ymd,day.e).rit
if(t!=null){pillClass="ok";pillText=fmtDur(t);sum+=t}else{pillText="In progress"}
}
const name=day.d.toLocaleDateString(undefined,{weekday:"long"})
const dstr=day.d.toLocaleDateString(undefined,{month:"short",day:"numeric"})
const item=document.createElement("div")
item.className="item"+(selectedYmd===day.ymd?" active":"")
item.innerHTML=`<div class="left"><div class="d">${name}</div><div class="m">${dstr} · ${day.ymd}</div></div><div class="pill ${pillClass}">${pillText}</div>`
item.addEventListener("click",()=>{selectedYmd=day.ymd;renderWeekView();renderDayDetail(day.ymd,day.d,day.e)})
weekList.appendChild(item)
}
wkTotal.textContent=fmtDur(sum)
if(!selectedYmd){dayDetail.classList.add("hidden")}else{
const sd=new Date(selectedYmd+"T00:00:00")
if(!inRange(sd,ws,we)){selectedYmd=null;dayDetail.classList.add("hidden")}
}
}

const renderDayDetail=(ymd,dayDate,entry)=>{
dayDetail.classList.remove("hidden")
const name=dayDate.toLocaleDateString(undefined,{weekday:"long"})
const dstr=dayDate.toLocaleDateString(undefined,{month:"long",day:"numeric",year:"numeric"})
detailTitle.textContent=`${name}`
detailSub.textContent=`${dstr} · ${ymd}`
const e=entry||getEntry(ymd)||{}
const r=computeFrom(ymd,e)
dCheckIn.textContent=clean(e.checkIn)||"--"
dRitStart.textContent=clean(e.ritStart)||"--"
dRitEnd.textContent=clean(e.ritEnd)||"--"
dCheckOut.textContent=clean(e.checkOut)||"--"
dRitTime.textContent=fmtDur(r.brk)
dTotal.textContent=fmtDur(r.total)
editDayBtn.onclick=()=>{switchToToday();dateEl.value=ymd;loadIntoForm(ymd)}
}

const loadIntoForm=ymd=>{
const e=getEntry(ymd)
if(e){
checkInEl.value=e.checkIn||""
ritStartEl.value=e.ritStart||""
ritEndEl.value=e.ritEnd||""
checkOutEl.value=e.checkOut||""
}else{
checkInEl.value=""
ritStartEl.value=""
ritEndEl.value=""
checkOutEl.value=""
}
renderToday()
}

const switchToToday=()=>{tabToday.classList.add("active");tabWeek.classList.remove("active");viewToday.classList.remove("hidden");viewWeek.classList.add("hidden");renderToday()}
const switchToWeek=()=>{tabWeek.classList.add("active");tabToday.classList.remove("active");viewWeek.classList.remove("hidden");viewToday.classList.add("hidden");renderWeekView()}
tabToday.addEventListener("click",switchToToday)
tabWeek.addEventListener("click",switchToWeek)

prevWeekBtn.addEventListener("click",()=>{weekOffset-=1;selectedYmd=null;renderWeekView()})
nextWeekBtn.addEventListener("click",()=>{weekOffset+=1;selectedYmd=null;renderWeekView()})
thisWeekBtn.addEventListener("click",()=>{weekOffset=0;selectedYmd=null;renderWeekView()})

const validateFinish=()=>{
const ymd=dateEl.value
if(!ymd)return{ok:false,msg:"Pick a date"}
if(!checkInEl.value||!ritStartEl.value||!ritEndEl.value||!checkOutEl.value)return{ok:false,msg:"Fill all times"}
const r=computeForInputs()
if(!(r.ci&&r.rs&&r.re&&r.co))return{ok:false,msg:"Fill all times"}
const orderOk=(r.ci<=r.rs)&&(r.rs<=r.re)&&(r.re<=r.co)
if(!orderOk)return{ok:false,msg:"Times must be in order"}
return{ok:true,msg:""}
}

saveBtn.addEventListener("click",()=>{
const ymd=dateEl.value
if(!ymd){alert("Pick a date");return}
const existing=getEntry(ymd)||{}
const merged={checkIn:clean(checkInEl.value)||existing.checkIn||"",ritStart:clean(ritStartEl.value)||existing.ritStart||"",ritEnd:clean(ritEndEl.value)||existing.ritEnd||"",checkOut:clean(checkOutEl.value)||existing.checkOut||""}
setEntry(ymd,merged)
renderToday()
alert("Saved")
})

finishBtn.addEventListener("click",()=>{
const v=validateFinish()
if(!v.ok){alert(v.msg);return}
const ymd=dateEl.value
setEntry(ymd,{checkIn:clean(checkInEl.value),ritStart:clean(ritStartEl.value),ritEnd:clean(ritEndEl.value),checkOut:clean(checkOutEl.value)})
renderToday()
alert("Shift saved")
})

deleteBtn.addEventListener("click",()=>{
const ymd=dateEl.value
if(!ymd){alert("Pick a date");return}
if(confirm("Delete this day?")){delEntry(ymd);loadIntoForm(ymd);alert("Deleted")}
})

fillNowBtn.addEventListener("click",()=>{
const now=new Date()
const t=`${pad(now.getHours())}:${pad(now.getMinutes())}`
if(!checkInEl.value)checkInEl.value=t
else if(!ritStartEl.value)ritStartEl.value=t
else if(!ritEndEl.value)ritEndEl.value=t
else if(!checkOutEl.value)checkOutEl.value=t
renderToday()
})

;[dateEl,checkInEl,ritStartEl,ritEndEl,checkOutEl].forEach(el=>el.addEventListener("input",renderToday))

exportBtn.addEventListener("click",(e)=>{
e.preventDefault()
const data=localStorage.getItem(SKEY)||"{}"
const blob=new Blob([data],{type:"application/json"})
const url=URL.createObjectURL(blob)
const a=document.createElement("a")
a.href=url
a.download="workrit-backup.json"
document.body.appendChild(a)
a.click()
a.remove()
setTimeout(()=>URL.revokeObjectURL(url),500)
})

importBtn.addEventListener("click",(e)=>{e.preventDefault();importFile.click()})
importFile.addEventListener("change",async()=>{
const f=importFile.files&&importFile.files[0]
if(!f)return
try{
const txt=await f.text()
const obj=JSON.parse(txt)
if(!obj||typeof obj!=="object")throw new Error("bad")
localStorage.setItem(SKEY,JSON.stringify(obj))
alert("Imported")
renderToday()
renderWeekView()
}catch{alert("Import failed")}
importFile.value=""
})

const init=()=>{
const today=toYMD(new Date())
dateEl.value=today
loadIntoForm(today)
}
init()
</script></body></html>